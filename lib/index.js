!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.puppeteer=t():n.puppeteer=t()}(this,function(){return function(n){function t(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return n[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var e={};return t.m=n,t.c=e,t.d=function(n,e,o){t.o(n,e)||Object.defineProperty(n,e,{configurable:!1,enumerable:!0,get:o})},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=0)}([function(n,t,e){"use strict";function o(){return o=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},o.apply(this,arguments)}function r(n){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=function(n){var t=window,e={},u={},i=null,c=!1,a=!1,p=function(){var t;n.dev&&(t=console).log.apply(t,arguments)},s=function(){var n;(n=console).warn.apply(n,arguments)},f=function(){var n;(n=console).error.apply(n,arguments)};return n.apps&&"object"===r(n.apps)||f('Missing "apps" object definition'),Object.keys(n.apps).forEach(function(t){var e=n.apps[t];e.loader||f('Missing "loader" for app',t),e.domHook||f('Missing "domHook" (element id) for app',t),e.mountFuncName||f('Missing "mountFuncName" (global mount function) for app',t)}),{subscribe:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};a&&["STORE:GET","STORE:SET","STORE:CHANGE"].includes(n)&&s("Piggybacking on STORE.GET/SET/CHANGE prohibited"),e.hasOwnProperty(n)||(e[n]=[]);var o=e[n].push(t)-1;return function(){return delete e[n][o]}},publish:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};p("--- TOPIC LAUNCHED ---",n,t);var o=e[n]&&e[n].length?e[n].map(function(n){return n(t)}):[];return Promise.all(o)},store:function(n,t){if(!a)return s("Store is not attached",n,t),!1;var e=this;switch(n){case"GET":return e.publish("STORE:GET",t).then(function(n){return n[0]});case"SET":return e.publish("STORE:SET",t);case"CHANGE":return e.subscribe("STORE:CHANGE",t);default:s("Unrecognised Store action",n,t)}},generateAppEvents:function(){var e=this,o=n.apps;return Object.keys(o).forEach(function(n){e.subscribe("".concat(n.toUpperCase(),":MOUNT"),function(){return!!o[n].mounted||o[n].loader().then(function(r){o[n].mounted=!0;var u=t[o[n].mountFuncName];if(!u)return s("Couldn't find mount function window."+o[n].mountFuncName),!1;o[n].unmount=u(e,o[n].domHook),e.publish("".concat(n.toUpperCase(),":MOUNT_SUCCESS"))})}),e.subscribe("".concat(n.toUpperCase(),":ACTION"),function(r){return o[n].mounted?i!==n&&(i&&o[i].unmount&&(e.publish("".concat(i.toUpperCase(),":UNMOUNT")),o[i].unmount||s(o[i].mountFuncName+"did not return unmount function"),o[i].unmount(),o[i].mounted=!1),i=n,void(!r.skipHashUpdate&&c&&(t.location.hash="#/".concat(n.toLowerCase())))):e.publish("".concat(n.toUpperCase(),":MOUNT")).then(function(){e.publish("".concat(n.toUpperCase(),":ACTION"),r)})})}),e},initiateAppRouter:function(){var e=this,o=n.apps;return e.subscribe("ROUTER:CUSTOM_HASH_CHANGE",function(){var n=t.location.hash,r=!1;if(Object.keys(o).forEach(function(t){var o=new RegExp("^#/"+t.toLowerCase()+"($|/)","g");n.match(o)&&(r=!0),n.match(o)&&i!==t&&e.publish("".concat(t.toUpperCase(),":ACTION"),{type:"openApp",skipHashUpdate:!0})}),r)return!0;e.publish("ROUTER:NONE_EXISTING_ROUTE"),i&&o[i].unmount&&(o[i].unmount(),o[i].mounted=!1,i=null)}),t.addEventListener("hashchange",function(){return e.publish("ROUTER:CUSTOM_HASH_CHANGE")}),e.publish("ROUTER:CUSTOM_HASH_CHANGE"),c=!0,e},attachStore:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;return u=n,t.subscribe("STORE:SET",function(n){if("object"!==r(n))return s("STORE:SET expect object s argument"),!1;u=o({},u,n),t.publish("STORE:CHANGE",n)}),t.subscribe("STORE:GET",function(n){return u[n]}),a=!0,t},getActiveApp:function(){return i}}},i=u;t.default=i}])});